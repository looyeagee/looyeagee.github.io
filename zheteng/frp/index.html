<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="LooyeaGee"><title>用自己的服务器搭个内网穿透服务 | 亦之日记</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css?20200712"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><script src="https://cdn.jsdelivr.net/npm/jquery@3.1.1/dist/jquery.min.js"></script><script src="/js/script.js"></script><script src="/js/tocbot.min.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)}()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script>$(function(){$("img").each(function(){var t;console.log($(this).data("nobox")),$(this).data("nobox")||(t=document.createElement("a"),$(t).attr("data-fancybox","gallery"),$(t).attr("href",$(this).attr("src")),$(t).attr("data-caption",$(this).attr("alt")),$(this).wrap(t),void 0!==(t=$(this).attr("alt"))&&null!=t&&""!=t&&$(this).after('<div style="text-align:center;text-decoration:none;color:#949292;">'+$(this).attr("alt")+"</div>"))})})</script><style></style><meta name="generator" content="Hexo 4.2.1"></head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">亦之日记</a></div><div class="menu navbar-right"><a class="menu-item" href="/archives/">文章</a> <a class="menu-item" href="/tag/">标签</a> <a class="menu-item" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a> <a class="menu-item" href="/categories/%E6%8A%98%E8%85%BE/">折腾</a> <a class="menu-item" href="/categories/%E7%A2%8E%E8%AF%AD/">碎语</a> <a class="menu-item" href="/categories/%E5%8E%9F%E5%88%9B%E8%BD%AF%E4%BB%B6/">原创软件</a> <a class="menu-item" href="/about/">关于</a> <a class="menu-item" href="/friendlylink/">友链</a> <a class="menu-item" href="https://snowbao.looyeagee.cn/" target="_blank" rel="noopener">雪宝Web版</a> <a class="menu-item" href="https://photo.looyeagee.cn/" target="_blank" rel="noopener">相册</a></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">亦之日记</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; 菜单</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives/">文章</a> <a class="menu-item" href="/tag/">标签</a> <a class="menu-item" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a> <a class="menu-item" href="/categories/%E6%8A%98%E8%85%BE/">折腾</a> <a class="menu-item" href="/categories/%E7%A2%8E%E8%AF%AD/">碎语</a> <a class="menu-item" href="/categories/%E5%8E%9F%E5%88%9B%E8%BD%AF%E4%BB%B6/">原创软件</a> <a class="menu-item" href="/about/">关于</a> <a class="menu-item" href="/friendlylink/">友链</a> <a class="menu-item" href="https://snowbao.looyeagee.cn/" target="_blank" rel="noopener">雪宝Web版</a> <a class="menu-item" href="https://photo.looyeagee.cn/" target="_blank" rel="noopener">相册</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">展开目录</a> <a onclick="go_top()">回到顶部</a> <a onclick="go_bottom()">转去底部</a></div></div><script>function expand_toc(){var t=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),t.setAttribute("onclick","collapse_toc()"),t.innerHTML="收起目录"}function collapse_toc(){var t=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),t.setAttribute("onclick","expand_toc()"),t.innerHTML="展开目录"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready(function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})})</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">用自己的服务器搭个内网穿透服务</h1><div class="post-meta">作者: <a itemprop="author" rel="author" href="/">LooyeaGee</a> <span class="post-time">日期: <a href="#">2020-08-10&nbsp;&nbsp;15:42</a> </span><span class="post-category">分类: <a href="/categories/%E6%8A%98%E8%85%BE/">折腾</a> </span><span class="post-category">访问量:<span id="article_pv">加载中...</span></span></div></header><div class="post-content"><h3 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h3><p>疫情在家的合作开发属实不方便，不在同一局域网下，前后端交互变得异常困难。由于公网IPv4地址的稀缺，现在三大运营商分配给我们拨号后的IP地址都是内网的了（我家是长沙联通，在宽带账号名后面加上@changsha能获取到公网IP，其他用户可以咨询自己的运营商看看能不能整个公网IP）。那么我们可以不可以利用自己的服务器作为中间商，A想连接B的端口，B主动连接到服务器建立好隧道，然后A连接服务器后通过隧道连接到B呢，答案是可以的。现在流行的内网穿透软件有<code>Ngrok</code>和<code>frp</code>，前者低版本是开源的，新版是闭源的；后者是国人的作品非常之好用，部署也很简单。那有同学问了，为啥不用向日葵啥的组建局域网呢，一个是收费，二个是如果我想穿透一个Web服务，向日葵是做不到的。再说了，有自己的服务器不好好利用不是浪费🐴。</p><h3 id="二、frps的部署"><a href="#二、frps的部署" class="headerlink" title="二、frps的部署"></a>二、frps的部署</h3><p>先去它的 <a href="https://github.com/fatedier/frp/" target="_blank" rel="noopener">GitHub</a>上根据自己的系统架构下载最新的版本，然后解压。编辑<code>frps.ini</code>如下配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="string">7000</span></span><br><span class="line"><span class="attr">vhost_http_port</span> = <span class="string">6088</span></span><br><span class="line"><span class="attr">authentication_method</span> = <span class="string">token</span></span><br><span class="line"><span class="attr">token</span> = <span class="string">your_token_here</span></span><br></pre></td></tr></table></figure><p>第一个端口是主要的端口，就是我们的<code>frpc</code>客户端通过这个端口连接到服务端的。第二个端口是HTTP服务的端口，专门用来映射客户端的HTTP服务。这些端口都可以自己随意设定。</p><p>配置好之后执行<code>frps -c frps.ini</code>即可运行frps服务器了。</p><h3 id="三、客户端的连接"><a href="#三、客户端的连接" class="headerlink" title="三、客户端的连接"></a>三、客户端的连接</h3><p>客户端<code>frpc.ini</code>如下配置：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = <span class="string">tcp</span></span><br><span class="line"><span class="attr">local_ip</span> = <span class="string">127.0.0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="string">22</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="string">6100</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[web]</span></span><br><span class="line"><span class="attr">type</span> = <span class="string">http</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="string">8080</span></span><br><span class="line"><span class="attr">custom_domains</span> = <span class="string">web.frp.looyeagee.cn</span></span><br><span class="line"></span><br><span class="line"><span class="attr">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="string">looyeagee.cn</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="string">7000</span></span><br><span class="line"><span class="attr">token</span> = <span class="string">your_token_here</span></span><br></pre></td></tr></table></figure><p>然后执行<code>frpc -c frpc.ini</code>就可以运行frpc客户端了。做好解析后就可以让别人访问<code>web.frp.looyeagee.cn:6088</code>来访问本机8080端口的Web服务了；也可以通过6100端口访问到本机的<code>SSH</code>服务了。</p><h3 id="四、其他设置"><a href="#四、其他设置" class="headerlink" title="四、其他设置"></a>四、其他设置</h3><p>这样还是没有很方便，因为每次还要配置域名的解析。所以我们可以做一个泛解析A记录。主机记录写上<code>*.frp</code>即可。这样就很方便啦，现在还有一个安全的问题，目前提供的是HTTP服务，虽然说<code>frp</code>提供了<code>HTTPS</code>服务，但是我使用了宝塔面板配置了其他网站，443端口被占用了。每次加上端口号访问真的不爽，所以我是这样做的：在宝塔新建一个网站，加上<code>*.frp.looyeagee.cn</code>这个通配域名，然后设置反向代理到<code>127.0.0.1:6088</code>即可，再开启强制<code>HTTPS</code>。这样我们访问HTTP就会自动重定向到HTTPS啦。</p><p><img src="https://cdn.looyeagee.cn/blog/img/2020/08/frp_baota.png-blog" alt="图1:宝塔配置截图"></p></div><section class="post-copyright"><p class="copyright-item"><span>文章作者:</span> <span>LooyeaGee</span></p><p class="copyright-item"><span>文章链接:</span> <span><a href="https://looyeagee.cn/zheteng/frp/">https://looyeagee.cn/zheteng/frp/</a></span></p><p class="copyright-item"><span>版权声明:</span> <span>本博客采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a>进行许可</span></p></section><section class="post-tags"><div><span>标签:</span> <span class="tag"><a href="/tags/frp/"># frp</a> <a href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"># 内网穿透</a></span></div><div><a href="javascript:window.history.back();">返回</a> <span>&nbsp;&nbsp; /&nbsp;&nbsp; </span><a href="/archives/">首页</a></div></section><section class="post-nav"><a class="prev" rel="prev" href="/notes/manjaro/">Manjaro KDE 安装微信、QQ记录</a> <a class="next" rel="next" href="/zheteng/UTermux/">好软推荐:UTermux</a></section><br><br><section id="comments" class="comments"><style>.comments{margin:30px;padding:10px;background:#fff}@media screen and (max-width:800px){.comments{margin:auto;padding:10px;background:#fff}}</style><div class="valine_comment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>new Valine({el:".valine_comment",app_id:"GGS59T6lHdF3dH3fhiSJwu4G-MdYXbMMI",app_key:"mqefY3TJMDaBRqc44I7OdYtY",placeholder:"说点什么呗",notify:"false",verify:"false",avatar:"monsterid",visitor:!0})</script></section></article></div></div><footer id="footer" class="footer">访问总量：<span id="pv">加载中...</span><br><a href="http://beian.miit.gov.cn" target="__blank">湘ICP备19026259号-1</a> • <a target="_blank" style="line-height:18px" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43018102000289"><img src="https://cdn.looyeagee.cn/blog/img/wangan.png" data-nobox="true" style="width:16px;height:16px;vertical-align:sub">湘公网安备43018102000289号</a><br>Copyright &copy; 2020 <a href="https://looyeagee.cn/">亦之日记</a> 的博客 • Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></footer><script>const path_name=decodeURI(window.location.pathname);$.ajax({type:"POST",url:"https://api.looyeagee.cn/api/visit"+path_name,success:function(t){$("#article_pv").html(t.hits),$("#pv").html(t.all)},error:function(t){}})</script></div></body></html>