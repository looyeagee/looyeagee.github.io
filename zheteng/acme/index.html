<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="LooyeaGee"><title>acme.sh自动申请多域名、泛域名、组合域名SSL证书 | 亦之日记</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css?20200712"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><script src="https://cdn.jsdelivr.net/npm/jquery@3.1.1/dist/jquery.min.js"></script><script src="/js/script.js"></script><script src="/js/tocbot.min.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)}()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script>$(function(){$("img").each(function(){var t;console.log($(this).data("nobox")),$(this).data("nobox")||(t=document.createElement("a"),$(t).attr("data-fancybox","gallery"),$(t).attr("href",$(this).attr("src")),$(t).attr("data-caption",$(this).attr("alt")),$(this).wrap(t),void 0!==(t=$(this).attr("alt"))&&null!=t&&""!=t&&$(this).after('<div style="text-align:center;text-decoration:none;color:#949292;">'+$(this).attr("alt")+"</div>"))})})</script><style></style><meta name="generator" content="Hexo 4.2.1"></head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">亦之日记</a></div><div class="menu navbar-right"><a class="menu-item" href="/archives/">文章</a> <a class="menu-item" href="/tag/">标签</a> <a class="menu-item" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a> <a class="menu-item" href="/categories/%E6%8A%98%E8%85%BE/">折腾</a> <a class="menu-item" href="/categories/%E7%A2%8E%E8%AF%AD/">碎语</a> <a class="menu-item" href="/categories/%E5%8E%9F%E5%88%9B%E8%BD%AF%E4%BB%B6/">原创软件</a> <a class="menu-item" href="/about/">关于</a> <a class="menu-item" href="/friendlylink/">友链</a> <a class="menu-item" href="https://snowbao.looyeagee.cn/" target="_blank" rel="noopener">雪宝Web版</a> <a class="menu-item" href="https://photo.looyeagee.cn/" target="_blank" rel="noopener">相册</a></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">亦之日记</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; 菜单</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives/">文章</a> <a class="menu-item" href="/tag/">标签</a> <a class="menu-item" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a> <a class="menu-item" href="/categories/%E6%8A%98%E8%85%BE/">折腾</a> <a class="menu-item" href="/categories/%E7%A2%8E%E8%AF%AD/">碎语</a> <a class="menu-item" href="/categories/%E5%8E%9F%E5%88%9B%E8%BD%AF%E4%BB%B6/">原创软件</a> <a class="menu-item" href="/about/">关于</a> <a class="menu-item" href="/friendlylink/">友链</a> <a class="menu-item" href="https://snowbao.looyeagee.cn/" target="_blank" rel="noopener">雪宝Web版</a> <a class="menu-item" href="https://photo.looyeagee.cn/" target="_blank" rel="noopener">相册</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">展开目录</a> <a onclick="go_top()">回到顶部</a> <a onclick="go_bottom()">转去底部</a></div></div><script>function expand_toc(){var t=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),t.setAttribute("onclick","collapse_toc()"),t.innerHTML="收起目录"}function collapse_toc(){var t=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),t.setAttribute("onclick","expand_toc()"),t.innerHTML="展开目录"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready(function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})})</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">acme.sh自动申请多域名、泛域名、组合域名SSL证书</h1><div class="post-meta">作者: <a itemprop="author" rel="author" href="/">LooyeaGee</a> <span class="post-time">日期: <a href="#">2020-05-22&nbsp;&nbsp;19:37</a> </span><span class="post-category">分类: <a href="/categories/%E6%8A%98%E8%85%BE/">折腾</a> </span><span class="post-category">访问量:<span id="article_pv">加载中...</span></span></div></header><div class="post-content"><h2 id="一、acme-sh的安装和使用"><a href="#一、acme-sh的安装和使用" class="headerlink" title="一、acme.sh的安装和使用"></a>一、acme.sh的安装和使用</h2><p>看到我的SSL证书了吗，看看它的<code>使用者可选名称</code>或者叫做<code>证书主题背景的备用名称</code>，是不是有一大堆？且有2个不同的主域名：<code>looyeagee.cn</code> 和 <code>csust-iotlab.com</code><br><img src="https://cdn.looyeagee.cn/blog/img/2020/05/cer_windows.png-blog" alt="图1:Windows下的证书解图"></p><p>对于一个多站点，甚至管理了不同二级域名的我来说：Https证书问题是一大困扰问题。如今免费的DV证书提供商大约有三家：</p><ul><li><p>1、Let’s Encrypt ：3个月有效期，支持多域名、泛域名、不同域名签发到一张证书上，最多签发100个域名。</p></li><li><p>2、TrustAsia：1年有效期，单域名（签发根域名会赠送一个www的子域名）</p></li><li><p>3、DigiCert Inc提供的Encryption Everywhere DV TLS CA - G1：1年有效期，单域名（签发根域名会赠送一个www的子域名）</p></li></ul><p>其中TrustAsia的兼容性应该是最好的，只不过它同一域名下只能签发20张，有数量限制，且不能签发泛域名。所以我打算选择Let’s Encrypt，虽然它的证书只有3个月，但是使用acme.sh能自动签发证书而且能够自动续签，十分方便。</p><p>使用如下命令安装<code>acme.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl https://get.acme.sh | sh</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><p>然后使用acme.sh命令即可使用它</p><h2 id="二、使用DNSPOD密钥"><a href="#二、使用DNSPOD密钥" class="headerlink" title="二、使用DNSPOD密钥"></a>二、使用DNSPOD密钥</h2><p>我的域名是在腾讯云上买的，所以DNS服务商是DNSPOD，如果你的不是DNSPOD提供服务，acme.sh还支持如下：CloudFlare、Aliyun、等等110余个提供商。你可以<a href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi" target="_blank" rel="noopener">点击这儿</a>查看列表。只不过，就算你是在其他地方买的，也可以将域名交给DNSPOD解析。</p><p>值得注意的是，如果你有多个域名都想把它签发到一张证书上，你需要确保你的DNSPOD帐号都管理了这些域名，而不是说只要是由DNSPOD提供服务而已。</p><p>登录DNSPOD后，来到<a href="https://console.dnspod.cn/account/token" target="_blank" rel="noopener">密钥管理</a>界面，点击创建密钥，名称随缘。</p><p><img src="https://cdn.looyeagee.cn/blog/img/2020/05/create_key.png-blog" alt="图2:创建密钥"></p><p>点击确定后会弹出</p><p><img src="https://cdn.looyeagee.cn/blog/img/2020/05/dnspod_key.png-blog" alt="图3:密钥结果"></p><p>注意保存好ID和Token到本地，信息只会展示一次。</p><h2 id="三、申请证书"><a href="#三、申请证书" class="headerlink" title="三、申请证书"></a>三、申请证书</h2><p>在终端执行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> DP_Id=<span class="string">"你的ID"</span></span><br><span class="line"><span class="built_in">export</span> DP_Key=<span class="string">"你的Token"</span></span><br></pre></td></tr></table></figure><p>然后我们即将进行签发证书，<strong>不过在此之前请注意，如果你的要申请的域名含有CNAME的解析记录，则最好将它暂停解析或者暂时用A记录代替。否则证书不能申请成功，当时我就有一个子域名做了CNAME记录，怎么也验证通过不了，网上提供的解决方法大多是错的。</strong></p><p>然后执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">acme.sh --issue -d *.looyeagee.cn -d looyeagee.cn -d *.home.looyeagee.cn -d *.frp.looyeagee.cn  -d *.csust-iotlab.com -d csust-iotlab.com -d *.frp.csust-iotlab.com -d *.blog.csust-iotlab.com --dns dns_dp</span><br></pre></td></tr></table></figure><p>其中第一个<code>-d</code>会作为证书的<code>公用名 (CN)</code>，你想申请几个就用几个<code>-d</code>即可。<code>--dns dns_dp</code>是指定DNSPOD服务商。若你的不是，你可以按照刚刚的DNS服务商列表查看参数。</p><p>这样，多域名、泛域名、不同域名合为一体的证书就签发完毕了。</p></div><section class="post-copyright"><p class="copyright-item"><span>文章作者:</span> <span>LooyeaGee</span></p><p class="copyright-item"><span>文章链接:</span> <span><a href="https://looyeagee.cn/zheteng/acme/">https://looyeagee.cn/zheteng/acme/</a></span></p><p class="copyright-item"><span>版权声明:</span> <span>本博客采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a>进行许可</span></p></section><section class="post-tags"><div><span>标签:</span> <span class="tag"><a href="/tags/acme-sh/"># acme.sh</a> <a href="/tags/SSL%E8%AF%81%E4%B9%A6/"># SSL证书</a> <a href="/tags/Https/"># Https</a></span></div><div><a href="javascript:window.history.back();">返回</a> <span>&nbsp;&nbsp; /&nbsp;&nbsp; </span><a href="/archives/">首页</a></div></section><section class="post-nav"><a class="prev" rel="prev" href="/zheteng/UTermux/">好软推荐:UTermux</a> <a class="next" rel="next" href="/zheteng/goaccess/">使用GoAccess日志分析工具为Hexo统计访问量</a></section><br><br><section id="comments" class="comments"><style>.comments{margin:30px;padding:10px;background:#fff}@media screen and (max-width:800px){.comments{margin:auto;padding:10px;background:#fff}}</style><div class="valine_comment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>new Valine({el:".valine_comment",app_id:"GGS59T6lHdF3dH3fhiSJwu4G-MdYXbMMI",app_key:"mqefY3TJMDaBRqc44I7OdYtY",placeholder:"说点什么呗",notify:"false",verify:"false",avatar:"monsterid",visitor:!0})</script></section></article></div></div><footer id="footer" class="footer">访问总量：<span id="pv">加载中...</span><br><a href="http://beian.miit.gov.cn" target="__blank">湘ICP备19026259号-1</a> • <a target="_blank" style="line-height:18px" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43018102000289"><img src="https://cdn.looyeagee.cn/blog/img/wangan.png" data-nobox="true" style="width:16px;height:16px;vertical-align:sub">湘公网安备43018102000289号</a><br>Copyright &copy; 2020 <a href="https://looyeagee.cn/">亦之日记</a> 的博客 • Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></footer><script>const path_name=decodeURI(window.location.pathname);$.ajax({type:"POST",url:"https://api.looyeagee.cn/api/visit"+path_name,success:function(t){$("#article_pv").html(t.hits),$("#pv").html(t.all)},error:function(t){}})</script></div></body></html>