<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="LooyeaGee"><title>初学SpringBoot遇到的坑和笔记 | 亦之日记</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css?20200712"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><script src="https://cdn.jsdelivr.net/npm/jquery@3.1.1/dist/jquery.min.js"></script><script src="/js/script.js"></script><script src="/js/tocbot.min.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)}()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script>$(function(){$("img").each(function(){var t;console.log($(this).data("nobox")),$(this).data("nobox")||(t=document.createElement("a"),$(t).attr("data-fancybox","gallery"),$(t).attr("href",$(this).attr("src")),$(t).attr("data-caption",$(this).attr("alt")),$(this).wrap(t),void 0!==(t=$(this).attr("alt"))&&null!=t&&""!=t&&$(this).after('<div style="text-align:center;text-decoration:none;color:#949292;">'+$(this).attr("alt")+"</div>"))})})</script><style></style><meta name="generator" content="Hexo 4.2.1"></head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">亦之日记</a></div><div class="menu navbar-right"><a class="menu-item" href="/archives/">文章</a> <a class="menu-item" href="/tag/">标签</a> <a class="menu-item" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a> <a class="menu-item" href="/categories/%E6%8A%98%E8%85%BE/">折腾</a> <a class="menu-item" href="/categories/%E7%A2%8E%E8%AF%AD/">碎语</a> <a class="menu-item" href="/categories/%E5%8E%9F%E5%88%9B%E8%BD%AF%E4%BB%B6/">原创软件</a> <a class="menu-item" href="/about/">关于</a> <a class="menu-item" href="/friendlylink/">友链</a> <a class="menu-item" href="https://snowbao.looyeagee.cn/" target="_blank" rel="noopener">雪宝Web版</a> <a class="menu-item" href="https://photo.looyeagee.cn/" target="_blank" rel="noopener">相册</a></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">亦之日记</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; 菜单</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives/">文章</a> <a class="menu-item" href="/tag/">标签</a> <a class="menu-item" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a> <a class="menu-item" href="/categories/%E6%8A%98%E8%85%BE/">折腾</a> <a class="menu-item" href="/categories/%E7%A2%8E%E8%AF%AD/">碎语</a> <a class="menu-item" href="/categories/%E5%8E%9F%E5%88%9B%E8%BD%AF%E4%BB%B6/">原创软件</a> <a class="menu-item" href="/about/">关于</a> <a class="menu-item" href="/friendlylink/">友链</a> <a class="menu-item" href="https://snowbao.looyeagee.cn/" target="_blank" rel="noopener">雪宝Web版</a> <a class="menu-item" href="https://photo.looyeagee.cn/" target="_blank" rel="noopener">相册</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">展开目录</a> <a onclick="go_top()">回到顶部</a> <a onclick="go_bottom()">转去底部</a></div></div><script>function expand_toc(){var t=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),t.setAttribute("onclick","collapse_toc()"),t.innerHTML="收起目录"}function collapse_toc(){var t=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),t.setAttribute("onclick","expand_toc()"),t.innerHTML="展开目录"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready(function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})})</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">初学SpringBoot遇到的坑和笔记</h1><div class="post-meta">作者: <a itemprop="author" rel="author" href="/">LooyeaGee</a> <span class="post-time">日期: <a href="#">2019-11-17&nbsp;&nbsp;11:50</a> </span><span class="post-category">分类: <a href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a> </span><span class="post-category">访问量:<span id="article_pv">加载中...</span></span></div></header><div class="post-content"><h2 id="1-日期返回给前端显示不理想问题"><a href="#1-日期返回给前端显示不理想问题" class="headerlink" title="1.日期返回给前端显示不理想问题"></a>1.日期返回给前端显示不理想问题</h2><h3 id="1-1重现"><a href="#1-1重现" class="headerlink" title="1.1重现"></a>1.1重现</h3><p>不作配置返回的Date类型如下，格式不令人满意，时间也少了8个小时</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"Date"</span>: <span class="string">"2019-11-17T11:39:15.000+0000"</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2原因"><a href="#1-2原因" class="headerlink" title="1.2原因"></a>1.2原因</h3><p>没有对<code>jackson</code>进行时间格式配置</p><h3 id="1-3解决"><a href="#1-3解决" class="headerlink" title="1.3解决"></a>1.3解决</h3><p>在<code>application.properties</code>中加入对jackson的时区和Date类型格式化配置:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.jackson.time-zone</span>=<span class="string">GMT+8</span></span><br><span class="line"><span class="meta">spring.jackson.date-format</span>=<span class="string">yyyy-MM-dd HH:mm:ss</span></span><br></pre></td></tr></table></figure><h3 id="1-4结果"><a href="#1-4结果" class="headerlink" title="1.4结果"></a>1.4结果</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"Date"</span>: <span class="string">"2019-11-17 19:39:15"</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="2-MyBatis-Plus数据库字段未找到问题"><a href="#2-MyBatis-Plus数据库字段未找到问题" class="headerlink" title="2.MyBatis-Plus数据库字段未找到问题"></a>2.MyBatis-Plus数据库字段未找到问题</h2><h3 id="2-1重现"><a href="#2-1重现" class="headerlink" title="2.1重现"></a>2.1重现</h3><p>运行就抛出<code>org.springframework.jdbc.BadSqlGrammarException:Error querying database. Cause: java.sql.SQLSyntaxErrorException: Unknown column &#39;user_name&#39; in &#39;field list&#39;</code>异常，实体类如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2原因"><a href="#2-2原因" class="headerlink" title="2.2原因"></a>2.2原因</h3><p><code>MyBatis-Plus</code>会自动将驼峰命名映射成含下划线的命名，如：<code>userName</code>会被转换成<code>user_name</code>，所以禁用这个即可。</p><h3 id="2-3解决"><a href="#2-3解决" class="headerlink" title="2.3解决"></a>2.3解决</h3><p>在<code>application.properties</code>中关闭映射即可：<br></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mybatis-plus.configuration.map-underscore-to-camel-case</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure><p></p><h2 id="3-Long型雪花主键返回给前端精度丢失问题"><a href="#3-Long型雪花主键返回给前端精度丢失问题" class="headerlink" title="3.Long型雪花主键返回给前端精度丢失问题"></a>3.Long型雪花主键返回给前端精度丢失问题</h2><h3 id="3-1重现"><a href="#3-1重现" class="headerlink" title="3.1重现"></a>3.1重现</h3><p>原本为1194942865416077314的雪花主键id返回给前端变成了：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">"id"</span>: <span class="number">1194942865416077300</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2原因"><a href="#3-2原因" class="headerlink" title="3.2原因"></a>3.2原因</h3><p>在Long长度大于17位时会出现精度丢失的问题（具体原因有待了解）</p><h3 id="3-3解决"><a href="#3-3解决" class="headerlink" title="3.3解决"></a>3.3解决</h3><p>在实体类上的雪花id加上注解<code>@JsonSerialize(using=ToStringSerializer.class)</code>，将长整数转换成字符串输出处理，如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="meta">@JsonSerialize</span>(using = ToStringSerializer<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">Long</span> <span class="title">id</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4结果"><a href="#3-4结果" class="headerlink" title="3.4结果"></a>3.4结果</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"id"</span>: <span class="string">"1194942865416077314"</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="4-Maven依赖下载过慢"><a href="#4-Maven依赖下载过慢" class="headerlink" title="4.Maven依赖下载过慢"></a>4.Maven依赖下载过慢</h2><h3 id="4-1原因"><a href="#4-1原因" class="headerlink" title="4.1原因"></a>4.1原因</h3><p>第一次初始化SpringBoot的时候依赖总是下到一半就卡住，因为国外网站真的是太慢了8！🌚</p><h3 id="4-2解决"><a href="#4-2解决" class="headerlink" title="4.2解决"></a>4.2解决</h3><p>换成阿里源即可，在<code>~/.m2/settings.xml</code>文件内写入以下内容（~代表用户目录，Windows则是在<code>C:\Users\用户名\.m2\setting.xml</code>，如果不存在，则新建）：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0</span></span></span><br><span class="line"><span class="tag"><span class="string">                          https://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>          </span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后在<code>IDEA</code>进行如下配置即可<br><img src="https://cdn.looyeagee.cn/blog/img/2019/11/2650084499.png-blog" alt="图1:IDEA Maven配置"></p><h2 id="5-实体对象某字段为空值返回给前端显示为null问题"><a href="#5-实体对象某字段为空值返回给前端显示为null问题" class="headerlink" title="5.实体对象某字段为空值返回给前端显示为null问题"></a>5.实体对象某字段为空值返回给前端显示为null问题</h2><h3 id="5-1重现"><a href="#5-1重现" class="headerlink" title="5.1重现"></a>5.1重现</h3><p>假如返回的实体对象的secret字段是null，返回给前端的效果如下，但我们不希望返回这个字段的内容</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"id"</span>: <span class="string">"1194942865416077314"</span>,<span class="attr">"secret"</span>: <span class="literal">null</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2原因"><a href="#5-2原因" class="headerlink" title="5.2原因"></a>5.2原因</h3><p>没有进行相关配置</p><h3 id="5-3解决"><a href="#5-3解决" class="headerlink" title="5.3解决"></a>5.3解决</h3><p>在相关的实体类前加上<code>@JsonInclude(JsonInclude.Include.NON_NULL)</code>注解即可，如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonInclude</span>(JsonInclude.Include.NON_NULL)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="meta">@JsonSerialize</span>(using = ToStringSerializer<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">Long</span> <span class="title">id</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String secret;</span><br></pre></td></tr></table></figure><h3 id="5-4结果"><a href="#5-4结果" class="headerlink" title="5.4结果"></a>5.4结果</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"id"</span>: <span class="string">"1194942865416077314"</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="6-Swagger2中全局参数的配置"><a href="#6-Swagger2中全局参数的配置" class="headerlink" title="6.Swagger2中全局参数的配置"></a>6.Swagger2中全局参数的配置</h2><h3 id="6-1问题"><a href="#6-1问题" class="headerlink" title="6.1问题"></a>6.1问题</h3><p>token作为很多接口都要用到的headers参数，一个个添加太麻烦了。</p><h3 id="6-2解决"><a href="#6-2解决" class="headerlink" title="6.2解决"></a>6.2解决</h3><p>可以进行以下配置，让所有Swagger2中接口都带上token参数（import省略），但是将required设置为false，因为部分接口如登录注册不需要提交jwt头部参数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger</span>2</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2Config</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ParameterBuilder tokenPar = <span class="keyword">new</span> ParameterBuilder();</span><br><span class="line">        List&lt;Parameter&gt; pars = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        tokenPar</span><br><span class="line">                .name(<span class="string">"jwt"</span>)</span><br><span class="line">                .description(<span class="string">"令牌"</span>)</span><br><span class="line">                .modelRef(<span class="keyword">new</span> ModelRef(<span class="string">"string"</span>))</span><br><span class="line">                .parameterType(<span class="string">"header"</span>)</span><br><span class="line">                .required(<span class="keyword">false</span>)</span><br><span class="line">                .defaultValue(<span class="string">"默认值，可以写入以方便前端测试"</span>)</span><br><span class="line">                .build();</span><br><span class="line">        pars.add(tokenPar.build());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .globalOperationParameters(pars)<span class="comment">//全局jwt参数</span></span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.looyeagee.clbb"</span>))</span><br><span class="line">                .paths(PathSelectors.any()).build().pathMapping(<span class="string">"/"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">"长理帮帮restful API"</span>)</span><br><span class="line">                .description(<span class="string">"by looyeagee"</span>)</span><br><span class="line">                .termsOfServiceUrl(<span class="string">"https://looyeagee.cn"</span>)</span><br><span class="line">                .version(<span class="string">"1.0"</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-3结果"><a href="#6-3结果" class="headerlink" title="6.3结果"></a>6.3结果</h3><p><img src="https://cdn.looyeagee.cn/blog/img/2019/11/1336844513.png-blog" alt="图2:全局JWT头"></p><h2 id="7-实体作为参数，但参数列表过长在Swagger2中需隐藏部分参数的问题"><a href="#7-实体作为参数，但参数列表过长在Swagger2中需隐藏部分参数的问题" class="headerlink" title="7.实体作为参数，但参数列表过长在Swagger2中需隐藏部分参数的问题"></a>7.实体作为参数，但参数列表过长在Swagger2中需隐藏部分参数的问题</h2><h3 id="7-1问题"><a href="#7-1问题" class="headerlink" title="7.1问题"></a>7.1问题</h3><p>注册接口和登录接口都要用到这个如下实体类，但是Swagger2不好怎么配置使登录接口只展示2个参数。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonInclude</span>(JsonInclude.Include.NON_NULL)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LoginGroup</span> </span>&#123;&#125;<span class="comment">//登录分组校验</span></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="meta">@JsonSerialize</span>(using = ToStringSerializer<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    @<span class="title">ApiModelProperty</span>(<span class="title">value</span> </span>= <span class="string">"用户id"</span>, hidden = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"用户名"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="meta">@NotBlank</span>(message = <span class="string">"用户名不能为空"</span>,groups = &#123;LoginGroup<span class="class">.<span class="keyword">class</span>, <span class="title">Default</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">    @<span class="title">Size</span>(<span class="title">min</span> </span>= <span class="number">5</span>, max = <span class="number">16</span>, message = <span class="string">"用户名长度必须为5-16个字符"</span>)</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank</span>(message = <span class="string">"密码不能为空"</span>,groups = &#123;LoginGroup<span class="class">.<span class="keyword">class</span>, <span class="title">Default</span>.<span class="title">class</span>&#125;)</span></span><br><span class="line"><span class="class">    @<span class="title">Pattern</span>(<span class="title">regexp</span> </span>= <span class="string">"^(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[!@#$_&amp;*+-])[0-9a-zA-Z!@#$_&amp;*+-]&#123;6,16&#125;$"</span>, message = <span class="string">"用户密码需要至少包含一个数字，一个字母，一个特殊字符且长度在6~16之间"</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"用户密码"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank</span>(message = <span class="string">"手机不能为空"</span>)</span><br><span class="line">    <span class="meta">@Pattern</span>(regexp = <span class="string">"^1[3456789]\\d&#123;9&#125;$"</span>,message = <span class="string">"输入的手机号码不符合规范"</span>)</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"手机号码"</span>, required = <span class="keyword">true</span>)</span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*还有好多好多好多字段不一一展示*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-2解决"><a href="#7-2解决" class="headerlink" title="7.2解决"></a>7.2解决</h3><p>现在注册接口和登录接口都要用到这个实体类，考虑到注册接口参数多一些所以直接在上述类中写好Swagger2中的配置，但是登录接口只要实体类中的用户名和密码这两个参数，所以不应该展示过多的参数，这时应该这样做，将登录、注册接口如下定义（import省略），Swagger2用<code>@ApiIgnore</code>注解忽略登录接口中的User参数，然后手动用<code>@ApiImplicitParams</code>和<code>@ApiImplicitParam</code>注解配置参数信息，具体参考下方代码。此外，SpringBoot还是得进行用户名和密码不能为null或空的参数检验，这时候为了区分注册接口要用的校验，就得使用到分组检验（可参考上面的实体类定义的检验注解，先定义一个分组接口，然后在需要校验的注解上加上<code>groups = {LoginGroup.class, Default.class}</code>这个参数即可，其中LoginGroup为分组接口名，然后再在控制类参数前加上<code>@Validated(value = User.LoginGroup.class)</code>注解即可）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/user"</span>)</span><br><span class="line"><span class="meta">@Api</span>(description = <span class="string">"用户登录注册查询"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserServiceImpl userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"登录"</span>, notes = <span class="string">"填写以下需要的"</span>)</span><br><span class="line">    <span class="meta">@ApiImplicitParams</span>(&#123;</span><br><span class="line">            <span class="meta">@ApiImplicitParam</span>(paramType = <span class="string">"query"</span>, name = <span class="string">"userName"</span>, value = <span class="string">"用户名"</span>, dataType = <span class="string">"String"</span>, example = <span class="string">"ohuo"</span>, required = <span class="keyword">true</span>),</span><br><span class="line">            <span class="meta">@ApiImplicitParam</span>(paramType = <span class="string">"query"</span>, name = <span class="string">"password"</span>, value = <span class="string">"密码"</span>, dataType = <span class="string">"String"</span>, example = <span class="string">"666"</span>, required = <span class="keyword">true</span>)&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"/login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultModel <span class="title">login</span><span class="params">(@ApiIgnore @Validated(value = User.LoginGroup.class)</span> User user) </span>&#123;</span><br><span class="line">        User loginUser = userService.login(user);</span><br><span class="line">        <span class="keyword">if</span> (loginUser == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ResultFailure(<span class="string">"登录失败，请检查帐号密码是否错误"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ResultSuccess(<span class="string">"登录成功，欢迎您"</span> + loginUser.getUserName(), userService.createJWTResultMap(loginUser));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"注册"</span>, notes = <span class="string">"填写以下需要的"</span>)</span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"/reg"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultModel <span class="title">reg</span><span class="params">(@Validated User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userService.addUser(user)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ResultSuccess(<span class="string">"注册成功"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ResultFailure(<span class="string">"存在重复用户名或手机号码！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-3结果"><a href="#7-3结果" class="headerlink" title="7.3结果"></a>7.3结果</h3><p>登录：<br><img src="https://cdn.looyeagee.cn/blog/img/2019/11/2434689805.png-blog" alt="图3:登录"></p><p><img src="https://cdn.looyeagee.cn/blog/img/2019/11/3630114303.png-blog" alt="图4:注册"></p><h2 id="8-参数为Date，前端不知道传啥格式"><a href="#8-参数为Date，前端不知道传啥格式" class="headerlink" title="8.参数为Date，前端不知道传啥格式"></a>8.参数为Date，前端不知道传啥格式</h2><h3 id="8-1重现"><a href="#8-1重现" class="headerlink" title="8.1重现"></a>8.1重现</h3><p>传日期进去不正确就会抛出<code>java.lang.IllegalArgumentException</code>异常</p><h3 id="8-2解决"><a href="#8-2解决" class="headerlink" title="8.2解决"></a>8.2解决</h3><p>按如下格式传入即可（0可以不补）<br><code>2019/11/17 23:05:55</code></p></div><section class="post-copyright"><p class="copyright-item"><span>文章作者:</span> <span>LooyeaGee</span></p><p class="copyright-item"><span>文章链接:</span> <span><a href="https://looyeagee.cn/notes/SSM/">https://looyeagee.cn/notes/SSM/</a></span></p><p class="copyright-item"><span>版权声明:</span> <span>本博客采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a>进行许可</span></p></section><section class="post-tags"><div><span>标签:</span> <span class="tag"><a href="/tags/SpringBoot/"># SpringBoot</a> <a href="/tags/SpringMVC/"># SpringMVC</a> <a href="/tags/Mybatis/"># Mybatis</a></span></div><div><a href="javascript:window.history.back();">返回</a> <span>&nbsp;&nbsp; /&nbsp;&nbsp; </span><a href="/archives/">首页</a></div></section><section class="post-nav"><a class="prev" rel="prev" href="/zheteng/R_UEFI/">误删Win10 UEFI引导项，咋整？</a> <a class="next" rel="next" href="/software/zuoyebao/">[开源]一键登录厂里作业宝（嘘～）</a></section><br><br><section id="comments" class="comments"><style>.comments{margin:30px;padding:10px;background:#fff}@media screen and (max-width:800px){.comments{margin:auto;padding:10px;background:#fff}}</style><div class="valine_comment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>new Valine({el:".valine_comment",app_id:"GGS59T6lHdF3dH3fhiSJwu4G-MdYXbMMI",app_key:"mqefY3TJMDaBRqc44I7OdYtY",placeholder:"说点什么呗",notify:"false",verify:"false",avatar:"monsterid",visitor:!0})</script></section></article></div></div><footer id="footer" class="footer">访问总量：<span id="pv">加载中...</span><br><a href="http://beian.miit.gov.cn" target="__blank">湘ICP备19026259号-1</a> • <a target="_blank" style="line-height:18px" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43018102000289"><img src="https://cdn.looyeagee.cn/blog/img/wangan.png" data-nobox="true" style="width:16px;height:16px;vertical-align:sub">湘公网安备43018102000289号</a><br>Copyright &copy; 2020 <a href="https://looyeagee.cn/">亦之日记</a> 的博客 • Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></footer><script>const path_name=decodeURI(window.location.pathname);$.ajax({type:"POST",url:"https://api.looyeagee.cn/api/visit"+path_name,success:function(t){$("#article_pv").html(t.hits),$("#pv").html(t.all)},error:function(t){}})</script></div></body></html>