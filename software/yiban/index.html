<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="LooyeaGee"><title>[开源]易班健康状态自动打卡 | 亦之日记</title><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css?20200712"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><script src="https://cdn.jsdelivr.net/npm/jquery@3.1.1/dist/jquery.min.js"></script><script src="/js/script.js"></script><script src="/js/tocbot.min.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)}()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script>$(function(){$("img").each(function(){var t;console.log($(this).data("nobox")),$(this).data("nobox")||(t=document.createElement("a"),$(t).attr("data-fancybox","gallery"),$(t).attr("href",$(this).attr("src")),$(t).attr("data-caption",$(this).attr("alt")),$(this).wrap(t),void 0!==(t=$(this).attr("alt"))&&null!=t&&""!=t&&$(this).after('<div style="text-align:center;text-decoration:none;color:#949292;">'+$(this).attr("alt")+"</div>"))})})</script><style></style><meta name="generator" content="Hexo 4.2.1"></head><body><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">亦之日记</a></div><div class="menu navbar-right"><a class="menu-item" href="/archives/">文章</a> <a class="menu-item" href="/tag/">标签</a> <a class="menu-item" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a> <a class="menu-item" href="/categories/%E6%8A%98%E8%85%BE/">折腾</a> <a class="menu-item" href="/categories/%E7%A2%8E%E8%AF%AD/">碎语</a> <a class="menu-item" href="/categories/%E5%8E%9F%E5%88%9B%E8%BD%AF%E4%BB%B6/">原创软件</a> <a class="menu-item" href="/about/">关于</a> <a class="menu-item" href="/friendlylink/">友链</a> <a class="menu-item" href="https://snowbao.looyeagee.cn/" target="_blank" rel="noopener">雪宝Web版</a> <a class="menu-item" href="https://photo.looyeagee.cn/" target="_blank" rel="noopener">相册</a></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div><a href="/">亦之日记</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; 菜单</div></div><div class="menu" id="mobile-menu"><a class="menu-item" href="/archives/">文章</a> <a class="menu-item" href="/tag/">标签</a> <a class="menu-item" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a> <a class="menu-item" href="/categories/%E6%8A%98%E8%85%BE/">折腾</a> <a class="menu-item" href="/categories/%E7%A2%8E%E8%AF%AD/">碎语</a> <a class="menu-item" href="/categories/%E5%8E%9F%E5%88%9B%E8%BD%AF%E4%BB%B6/">原创软件</a> <a class="menu-item" href="/about/">关于</a> <a class="menu-item" href="/friendlylink/">友链</a> <a class="menu-item" href="https://snowbao.looyeagee.cn/" target="_blank" rel="noopener">雪宝Web版</a> <a class="menu-item" href="https://photo.looyeagee.cn/" target="_blank" rel="noopener">相册</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><div class="main"><div class="container"><div class="post-toc"><div class="tocbot-list"></div><div class="tocbot-list-menu"><a class="tocbot-toc-expand" onclick="expand_toc()">展开目录</a> <a onclick="go_top()">回到顶部</a> <a onclick="go_bottom()">转去底部</a></div></div><script>function expand_toc(){var t=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:6,orderedList:!1,scrollSmooth:!0}),t.setAttribute("onclick","collapse_toc()"),t.innerHTML="收起目录"}function collapse_toc(){var t=document.querySelector(".tocbot-toc-expand");tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0}),t.setAttribute("onclick","expand_toc()"),t.innerHTML="展开目录"}function go_top(){window.scrollTo(0,0)}function go_bottom(){window.scrollTo(0,document.body.scrollHeight)}document.ready(function(){tocbot.init({tocSelector:".tocbot-list",contentSelector:".post-content",headingSelector:"h1, h2, h3, h4, h5",collapseDepth:1,orderedList:!1,scrollSmooth:!0})})</script><article class="post-wrap"><header class="post-header"><h1 class="post-title">[开源]易班健康状态自动打卡</h1><div class="post-meta">作者: <a itemprop="author" rel="author" href="/">LooyeaGee</a> <span class="post-time">日期: <a href="#">2020-02-20&nbsp;&nbsp;04:09</a> </span><span class="post-category">分类: <a href="/categories/%E5%8E%9F%E5%88%9B%E8%BD%AF%E4%BB%B6/">原创软件</a> </span><span class="post-category">访问量:<span id="article_pv">加载中...</span></span></div></header><div class="post-content"><blockquote><p>注1：本程序只对长沙理工大学做了适配，其它大学需要自行抓包改代码哦~</p></blockquote><blockquote><p>注2：对于首次打卡十几天后易班对校本化的授权可能会失效，这次重新加上判断授权失败重新授权的代码。已于2020-04-11测试无误。</p></blockquote><h1 id="😎前沿"><a href="#😎前沿" class="headerlink" title="😎前沿"></a>😎前沿</h1><p>项目地址：<a href="https://github.com/looyeagee/yiban_auto_submit" target="_blank" rel="noopener">https://github.com/looyeagee/yiban_auto_submit</a></p><p>学校需要每天打卡，而健康的我打卡内容每天也是一样的。所以我就想实现一个自动打卡的程序。</p><h1 id="🚀准备工具"><a href="#🚀准备工具" class="headerlink" title="🚀准备工具"></a>🚀准备工具</h1><h2 id="HttpCanary-安卓手机抓包大师"><a href="#HttpCanary-安卓手机抓包大师" class="headerlink" title="HttpCanary - 安卓手机抓包大师"></a>HttpCanary - 安卓手机抓包大师</h2><p>HttpCanary是一款功能强大的HTTP/HTTPS/HTTP2网络包抓取和分析工具，你可以把他看成是移动端的Fiddler或者Charles，但是HttpCanary使用起来更加地简单容易，因为它是专门为移动端设计的！</p><h1 id="🌐重要包文"><a href="#🌐重要包文" class="headerlink" title="🌐重要包文"></a>🌐重要包文</h1><p>我是安卓手机，使用的软件是<code>HttpCanary</code>，非常好用，可以买个高级版支持作者。由于我安卓手机已经Root，直接信任了假的根证书。若是非Root用户，请使用<code>平行空间</code>处理（根据软件引导即可）开启抓包后，依次进行<code>登录系统</code>，<code>易班校本化</code>，<code>每日健康打卡</code>,<code>选择今日打卡任务</code>,<code>填写反馈</code>,<code>提交</code>操作。</p><h2 id="1、-重要-登录包"><a href="#1、-重要-登录包" class="headerlink" title="1、[重要]登录包"></a>1、[重要]登录包</h2><p>(已于20201119更新)感谢B站用户<a href="https://space.bilibili.com/45807603" target="_blank" rel="noopener">破损的鞘翅</a>提供的好用并且简洁的接口。</p><table><thead><tr><th align="center">类别</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">路径</td><td align="left"><a href="https://mobile.yiban.cn/api/v3/passport/login" target="_blank" rel="noopener">https://mobile.yiban.cn/api/v3/passport/login</a></td></tr><tr><td align="center">方式</td><td align="left">GET</td></tr><tr><td align="center">URL参数</td><td align="left"><code>mobile</code>：手机号</td></tr><tr><td align="center">URL参数</td><td align="left"><code>password</code>：明文密码</td></tr><tr><td align="center">URL参数</td><td align="left"><code>imei</code>：设备识别号，可以乱填</td></tr></tbody></table><p>若登录成功，返回的是个人信息和<strong>access_token</strong>（重要）。</p><h2 id="2、首页信息包（程序可以不访问写死iapp就好）"><a href="#2、首页信息包（程序可以不访问写死iapp就好）" class="headerlink" title="2、首页信息包（程序可以不访问写死iapp就好）"></a>2、首页信息包（程序可以不访问写死iapp就好）</h2><table><thead><tr><th align="center">类别</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">路径</td><td align="left"><a href="https://mobile.yiban.cn/api/v3/home" target="_blank" rel="noopener">https://mobile.yiban.cn/api/v3/home</a></td></tr><tr><td align="center">方式</td><td align="left">GET</td></tr><tr><td align="center">URL参数</td><td align="left"><code>access_token</code>：登录包下发的access_token</td></tr></tbody></table><p>在返回的data的hotApps里有个这样的信息记录着打卡入口的地址</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"易班校本化"</span>,</span><br><span class="line">    <span class="attr">"icon"</span>: <span class="string">"http://yfs01.fs.yiban.cn/web/1BQ48Z"</span>,</span><br><span class="line">    <span class="attr">"url"</span>: <span class="string">"http://f.yiban.cn/iapp7463?access_token=假装打码token&amp;v_time=158509617310884"</span>,</span><br><span class="line">    <span class="attr">"hyaline"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"source"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"app_id"</span>: <span class="number">80440</span>,</span><br><span class="line">    <span class="attr">"app_type"</span>: <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、-重要-二次请求码获取包"><a href="#3、-重要-二次请求码获取包" class="headerlink" title="3、[重要]二次请求码获取包"></a>3、[重要]二次请求码获取包</h2><p>上面的包的url数据比较重要，访问后会重定向到<code>http://f.yiban.cn/iapp/index?act=iapp7463&amp;v={token}</code>，再访问这个重定向，又会被重定向到<code>https://c.uyiban.com/#/?verify_request={verify_request}&amp;yb_uid=13192120</code>，其中<strong>verify_request</strong>很重要，用来二次认证作请求码。</p><h2 id="4、-重要-二次认证包"><a href="#4、-重要-二次认证包" class="headerlink" title="4、[重要]二次认证包"></a>4、[重要]二次认证包</h2><table><thead><tr><th align="center">类别</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">路径</td><td align="left"><a href="https://api.uyiban.com/base/c/auth/yiban" target="_blank" rel="noopener">https://api.uyiban.com/base/c/auth/yiban</a></td></tr><tr><td align="center">方式</td><td align="left">GET</td></tr><tr><td align="center">URL参数</td><td align="left"><code>verifyRequest</code>：认证请求码，也就是刚刚的<strong>verify_request</strong></td></tr><tr><td align="center">URL参数</td><td align="left"><code>CSRF</code>:Cross-site request forgery，防跨站请求伪造的token。本来应该是服务端下发，经检测，这里是客户端随机生成的字符串，可以随便填东西。服务端会记住这个东西，所以以后的请求也要提交一样的字符串</td></tr><tr><td align="center">Cookies</td><td align="left"><code>csrf_token</code>：刚刚客户端生成的字符串</td></tr></tbody></table><p>若请求成功，会返回个人的信息，下发了2个Cookies，以后的请求都要带上，其中一个是PHPSESSID，一个是cpi。其中cpi可以base64解码：信息为</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"Channel"</span>: <span class="string">"yiban"</span>,</span><br><span class="line">    <span class="attr">"Expire"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"Client"</span>: <span class="string">"c"</span>,</span><br><span class="line">    <span class="attr">"PersonId"</span>: <span class="string">"假装打码"</span>,</span><br><span class="line">    <span class="attr">"UniversityName"</span>: <span class="string">"长沙理工大学"</span>,</span><br><span class="line">    <span class="attr">"City"</span>: <span class="string">"长沙市"</span>,</span><br><span class="line">    <span class="attr">"PersonType"</span>: <span class="string">"student"</span>,</span><br><span class="line">    <span class="attr">"Grade"</span>: <span class="number">2017</span>,</span><br><span class="line">    <span class="attr">"Gender"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"EducationLevel"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"Timestamp"</span>: <span class="number">1581782834</span>,</span><br><span class="line">    <span class="attr">"Token"</span>: <span class="string">"假装打码"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>好像也没啥用，主要是是PHPSESSID记录了会话信息。</p><h2 id="5、未完成打卡清单"><a href="#5、未完成打卡清单" class="headerlink" title="5、未完成打卡清单"></a>5、未完成打卡清单</h2><table><thead><tr><th align="center">类别</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">路径</td><td align="left"><a href="https://api.uyiban.com/officeTask/client/index/uncompletedList" target="_blank" rel="noopener">https://api.uyiban.com/officeTask/client/index/uncompletedList</a></td></tr><tr><td align="center">方式</td><td align="left">GET</td></tr><tr><td align="center">URL参数</td><td align="left"><code>CSRF</code>：刚刚的随机字符串</td></tr><tr><td align="center">Cookies</td><td align="left"><code>csrf_token</code>：刚刚生成的随机值；还有刚刚下发的2个Cookies</td></tr></tbody></table><p>返回如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"data"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"TaskId"</span>: <span class="string">"假装打码"</span>,</span><br><span class="line">            <span class="attr">"OrgId"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"TimeoutState"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"Title"</span>: <span class="string">"2月15日长沙理工大学健康打卡拟登记表"</span>,</span><br><span class="line">            <span class="attr">"Type"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"StartTime"</span>: <span class="number">1581696000</span>,</span><br><span class="line">            <span class="attr">"EndTime"</span>: <span class="number">1581782340</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中重要的是<code>TaskId</code>任务Id等下要提交的。其他的不怎么用得到，<code>TimeoutState</code>是是否超时的一个状态码，<code>Type</code>不清楚，此外还有开始时间和截止时间等信息。</p><h2 id="6、任务详细"><a href="#6、任务详细" class="headerlink" title="6、任务详细"></a>6、任务详细</h2><table><thead><tr><th align="center">类别</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">路径</td><td align="left"><a href="https://api.uyiban.com/officeTask/client/index/detail" target="_blank" rel="noopener">https://api.uyiban.com/officeTask/client/index/detail</a></td></tr><tr><td align="center">方式</td><td align="left">GET</td></tr><tr><td align="center">URL参数</td><td align="left"><code>CSRF</code>：刚刚的随机字符串</td></tr><tr><td align="center">URL参数</td><td align="left"><code>TaskId</code>：具体打卡任务的Id</td></tr><tr><td align="center">Cookies</td><td align="left"><code>csrf_token</code>：刚刚生成的随机值；还有刚刚下发的2个Cookies</td></tr></tbody></table><p>返回如下JSON：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"msg"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"data"</span>: &#123;</span><br><span class="line">        <span class="attr">"Id"</span>: <span class="string">"假装打码"</span>,</span><br><span class="line">        <span class="attr">"Title"</span>: <span class="string">"2月15日长沙理工大学健康打卡拟登记表"</span>,</span><br><span class="line">        <span class="attr">"Type"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"TypeId"</span>: <span class="string">"2846c4086bc70b93ce3295800b764fb1"</span>,</span><br><span class="line">        <span class="attr">"PubOrgName"</span>: <span class="string">"学生工作部"</span>,</span><br><span class="line">        <span class="attr">"PubPersonName"</span>: <span class="string">"曹婷"</span>,</span><br><span class="line">        <span class="attr">"Content"</span>: <span class="string">"&lt;p&gt;请同学们认真填写，在疫情面前，每个人都能够出一份力！&lt;/p&gt;"</span>,</span><br><span class="line">        <span class="attr">"AttachmentIds"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="attr">"PubOrgId"</span>: <span class="string">"0e70b45b68bfd3c42c9cfe7440721b31"</span>,</span><br><span class="line">        <span class="attr">"StartTime"</span>: <span class="number">1581696000</span>,</span><br><span class="line">        <span class="attr">"TimeState"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"WFId"</span>: <span class="string">"d336f36226e932d152ed54cc2a1baf20"</span>,</span><br><span class="line">        <span class="attr">"AttachmentList"</span>: [],</span><br><span class="line">        <span class="attr">"WorkflowState"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"RetreatCount"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"InitiateId"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="attr">"RetreatReason"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="attr">"EvaluationState"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"EvaluationReason"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="attr">"State"</span>: <span class="string">"uncompleted"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中最重要的是<code>WFId</code>,经研究，这个是固定的表单Id，也就是说只要我们要填的表单内容不变，这个值永远不变，经发现从试运行到现在一直是同一份表单。记录下固定的<code>WFId</code>就好。其中的<code>Title</code>、<code>PubOrgName</code>和<code>PubPersonName</code>提交打卡表单的时候要用到。</p><h2 id="7、表单详细（程序不需访问）"><a href="#7、表单详细（程序不需访问）" class="headerlink" title="7、表单详细（程序不需访问）"></a>7、表单详细（程序不需访问）</h2><table><thead><tr><th align="center">类别</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">路径</td><td align="left"><a href="https://api.uyiban.com/workFlow/c/my/form/{WFId}" target="_blank" rel="noopener">https://api.uyiban.com/workFlow/c/my/form/{WFId}</a></td></tr><tr><td align="center">方式</td><td align="left">GET</td></tr><tr><td align="center">路径占位符参数</td><td align="left"><code>WFId</code>：固定的疫情表单Id</td></tr><tr><td align="center">URL参数</td><td align="left"><code>CSRF</code>：刚刚的随机字符串</td></tr><tr><td align="center">Cookies</td><td align="left"><code>csrf_token</code>：刚刚生成的随机值；还有刚刚下发的2个Cookies</td></tr></tbody></table><p>这个对程序来说更不重要了，就是获取表单里面要填的东西。对返回的东西进行二次解析后结果是：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"Input"</span>,</span><br><span class="line">        <span class="attr">"props"</span>: &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"姓名"</span>,</span><br><span class="line">            <span class="attr">"placeholder"</span>: <span class="string">"请输入"</span>,</span><br><span class="line">            <span class="attr">"required"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"69d1ca628e017a2c182902bfabdabd42"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"Input"</span>,</span><br><span class="line">        <span class="attr">"props"</span>: &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"专业班级"</span>,</span><br><span class="line">            <span class="attr">"placeholder"</span>: <span class="string">"请输入"</span>,</span><br><span class="line">            <span class="attr">"required"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"5680543d3631077265b049b7d9ae418e"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"GdMap"</span>,</span><br><span class="line">        <span class="attr">"props"</span>: &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"家庭所在地(到县)"</span>,</span><br><span class="line">            <span class="attr">"extra"</span>: <span class="string">"请选择"</span>,</span><br><span class="line">            <span class="attr">"required"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"params"</span>: &#123;</span><br><span class="line">                <span class="attr">"keywords"</span>: <span class="string">""</span>,</span><br><span class="line">                <span class="attr">"zoom"</span>: <span class="number">15</span>,</span><br><span class="line">                <span class="attr">"radius"</span>: <span class="number">1000</span>,</span><br><span class="line">                <span class="attr">"total"</span>: <span class="number">20</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"e62910f76e9d5ba63ddc84ae68606f0f"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"GdMap"</span>,</span><br><span class="line">        <span class="attr">"props"</span>: &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"目前所在地(到县)"</span>,</span><br><span class="line">            <span class="attr">"extra"</span>: <span class="string">"请选择"</span>,</span><br><span class="line">            <span class="attr">"required"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"params"</span>: &#123;</span><br><span class="line">                <span class="attr">"keywords"</span>: <span class="string">""</span>,</span><br><span class="line">                <span class="attr">"zoom"</span>: <span class="number">15</span>,</span><br><span class="line">                <span class="attr">"radius"</span>: <span class="number">1000</span>,</span><br><span class="line">                <span class="attr">"total"</span>: <span class="number">20</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"ba7cabc21493b23bcfd65fa79525c4e0"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"Input"</span>,</span><br><span class="line">        <span class="attr">"props"</span>: &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"当前体温"</span>,</span><br><span class="line">            <span class="attr">"placeholder"</span>: <span class="string">"℃"</span>,</span><br><span class="line">            <span class="attr">"required"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"cf4bac544816ca83db09a7d8c4d69178"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//省略……………………………………………………………………</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"Radio"</span>,</span><br><span class="line">        <span class="attr">"props"</span>: &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"2周内是否接触过确诊病例"</span>,</span><br><span class="line">            <span class="attr">"extra"</span>: <span class="string">"请选择"</span>,</span><br><span class="line">            <span class="attr">"options"</span>: [</span><br><span class="line">                <span class="string">"是"</span>,</span><br><span class="line">                <span class="string">"否"</span>,</span><br><span class="line">                <span class="string">"情况下方补充说明"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"required"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"a6288aa438a4e6e9264f029cc8dc5a5d"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"component"</span>: <span class="string">"Textarea"</span>,</span><br><span class="line">        <span class="attr">"props"</span>: &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"是否接触过确诊病例补充"</span>,</span><br><span class="line">            <span class="attr">"placeholder"</span>: <span class="string">"请输入"</span>,</span><br><span class="line">            <span class="attr">"required"</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"a34eef03f5588c95241cb3bdf30e025c"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>其中<code>id</code>就是具体要填写的内容的<code>id</code>，<code>required</code>是这项是否必填。</p><h2 id="8、-重点-表单提交"><a href="#8、-重点-表单提交" class="headerlink" title="8、[重点]表单提交"></a>8、[重点]表单提交</h2><table><thead><tr><th align="center">类别</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">路径</td><td align="left"><a href="https://api.uyiban.com/workFlow/c/my/apply/{WFId}" target="_blank" rel="noopener">https://api.uyiban.com/workFlow/c/my/apply/{WFId}</a></td></tr><tr><td align="center">方式</td><td align="left">POST</td></tr><tr><td align="center">路径占位符参数</td><td align="left"><code>WFId</code>：固定的疫情表单Id</td></tr><tr><td align="center">URL参数</td><td align="left"><code>CSRF</code>：刚刚的随机字符串</td></tr><tr><td align="center">URL参数</td><td align="left"><code>TaskId</code>：具体打卡任务的Id</td></tr><tr><td align="center">Cookies</td><td align="left"><code>csrf_token</code>：刚刚生成的随机值；还有刚刚下发的所有Cookies</td></tr></tbody></table><p>POST BODY有两个：<br><code>data</code>：表单具体内容，如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"69d1ca628e017a2c182902bfabdabd42"</span>: <span class="string">"姓名"</span>,</span><br><span class="line">    <span class="attr">"5680543d3631077265b049b7d9ae418e"</span>: <span class="string">"班级"</span>,</span><br><span class="line">    <span class="attr">"e62910f76e9d5ba63ddc84ae68606f0f"</span>: &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"地址名"</span>,</span><br><span class="line">        <span class="attr">"location"</span>: <span class="string">"经度,纬度"</span>,<span class="comment">//注：精确到小数点6位</span></span><br><span class="line">        <span class="attr">"address"</span>: <span class="string">"详细地址"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"ba7cabc21493b23bcfd65fa79525c4e0"</span>: &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"地址名"</span>,</span><br><span class="line">        <span class="attr">"location"</span>: <span class="string">"经度,纬度"</span>,<span class="comment">//注：精确到小数点6位</span></span><br><span class="line">        <span class="attr">"address"</span>: <span class="string">"详细地址"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"cf4bac544816ca83db09a7d8c4d69178"</span>: <span class="string">"温度"</span>,</span><br><span class="line">    <span class="attr">"f16558084d32bee1523e085c9be35c30"</span>: <span class="string">"无"</span>,</span><br><span class="line">    <span class="attr">"78bb535617d4caf28944bff53f434e32"</span>: <span class="string">"无"</span>,</span><br><span class="line">    <span class="attr">"43cfde1796a98708e3df57f8088460e4"</span>: <span class="string">"无"</span>,</span><br><span class="line">    <span class="attr">"8f472f4a665f93acf3de5c4ecab8c213"</span>: <span class="string">"无"</span>,</span><br><span class="line">    <span class="attr">"e8578087affe7bde28eb5b6ffa5149e1"</span>: <span class="string">"否"</span>,</span><br><span class="line">    <span class="attr">"24d085dd92e3a2bf43fef782e1fc7025"</span>: <span class="string">"否"</span>,</span><br><span class="line">    <span class="attr">"bd397e1b6437a9dc6129db60d82ffd02"</span>: <span class="string">"否"</span>,</span><br><span class="line">    <span class="attr">"d5adcefa1558c2759edd7c1cb41afbc4"</span>: <span class="string">"健康描述"</span>,</span><br><span class="line">    <span class="attr">"484b372a88bb52cc0c54dcfbe618f779"</span>: <span class="string">"家庭健康描述"</span>,</span><br><span class="line">    <span class="attr">"f0ac1554f16879b966c2135bcf3bdb53"</span>: <span class="string">"否"</span>,</span><br><span class="line">    <span class="attr">"7b771dd1f3512486fac560cfec00052b"</span>: <span class="string">"否"</span>,</span><br><span class="line">    <span class="attr">"a6288aa438a4e6e9264f029cc8dc5a5d"</span>: <span class="string">"否"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若你要使用，直接修改上方的一些数据即可。<br><code>extend</code>，是传一些自定义信息，经检测，应该是固定的三个信息：任务名称、发布机构、发布人。这三个信息可以在第4个包里找到。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"TaskId"</span>: <span class="string">"假装打码"</span>,</span><br><span class="line">    <span class="attr">"title"</span>: <span class="string">"任务信息"</span>,</span><br><span class="line">    <span class="attr">"content"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"任务名称"</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"3月25日长沙理工大学健康打卡登记表"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"发布机构"</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"学生工作部"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"发布人"</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"长沙理工大学"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>正确的话，请求返回的code是整数0，并且会返回<code>initiateId</code>用于转发表单。</p><h2 id="9、获取转发表单URL"><a href="#9、获取转发表单URL" class="headerlink" title="9、获取转发表单URL"></a>9、获取转发表单URL</h2><table><thead><tr><th align="center">类别</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">路径</td><td align="left"><a href="https://api.uyiban.com/workFlow/c/work/share?InitiateId=%s&amp;CSRF=%s" target="_blank" rel="noopener">https://api.uyiban.com/workFlow/c/work/share?InitiateId=%s&amp;CSRF=%s</a></td></tr><tr><td align="center">方式</td><td align="left">GET</td></tr><tr><td align="center">URL参数</td><td align="left"><code>CSRF</code>：刚刚的随机字符串</td></tr><tr><td align="center">URL参数</td><td align="left"><code>InitiateId</code>：刚刚打卡返回的</td></tr><tr><td align="center">Cookies</td><td align="left"><code>csrf_token</code>：刚刚生成的随机值；还有刚刚下发的所有Cookies</td></tr></tbody></table><p>可以得到人人可以访问的表单浏览URL</p><h1 id="😍源码"><a href="#😍源码" class="headerlink" title="😍源码"></a>😍源码</h1><p>20201117更新，请打开<a href="https://github.com/looyeagee/yiban_auto_submit" target="_blank" rel="noopener">https://github.com/looyeagee/yiban_auto_submit</a> 查看详情</p><h2 id="main-py"><a href="#main-py" class="headerlink" title="main.py"></a>main.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">from</span> yiban <span class="keyword">import</span> YiBan</span><br><span class="line"><span class="keyword">import</span> util</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        yb = YiBan(<span class="string">"phone"</span>, <span class="string">"password"</span>) <span class="comment"># <span class="doctag">FIXME:</span>账号密码</span></span><br><span class="line">        yb.login()</span><br><span class="line">        yb.getHome()</span><br><span class="line">        print(<span class="string">"登录成功 %s"</span>%yb.name)</span><br><span class="line">        yb.auth()</span><br><span class="line">        all_task = yb.getUncompletedList()[<span class="string">"data"</span>]</span><br><span class="line">        all_task = list(filter(<span class="keyword">lambda</span> x: <span class="string">"体温检测"</span> <span class="keyword">in</span> x[<span class="string">"Title"</span>], all_task))  <span class="comment"># <span class="doctag">FIXME:</span> 长理的打卡任务标题均含有"体温检测"字样 此举是防止其他表单干扰 （可能会变）</span></span><br><span class="line">        <span class="keyword">if</span> len(all_task) == <span class="number">0</span>:</span><br><span class="line">            print(<span class="string">"没找到今天长理体温上报的任务，可能是你已经上报，如果不是请手动上报。"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            all_task_sort = util.desc_sort(all_task, <span class="string">"StartTime"</span>)  <span class="comment"># 按开始时间排序</span></span><br><span class="line">            new_task = all_task_sort[<span class="number">0</span>]  <span class="comment"># 只取一个最新的</span></span><br><span class="line">            print(<span class="string">"找到未上报的任务："</span>, new_task)</span><br><span class="line">            task_detail = yb.getTaskDetail(new_task[<span class="string">"TaskId"</span>])[<span class="string">"data"</span>]</span><br><span class="line">            ex = &#123;<span class="string">"TaskId"</span>: task_detail[<span class="string">"Id"</span>],</span><br><span class="line">                <span class="string">"title"</span>: <span class="string">"任务信息"</span>,</span><br><span class="line">                <span class="string">"content"</span>: [&#123;<span class="string">"label"</span>: <span class="string">"任务名称"</span>, <span class="string">"value"</span>: task_detail[<span class="string">"Title"</span>]&#125;,</span><br><span class="line">                            &#123;<span class="string">"label"</span>: <span class="string">"发布机构"</span>, <span class="string">"value"</span>: task_detail[<span class="string">"PubOrgName"</span>]&#125;,</span><br><span class="line">                            &#123;<span class="string">"label"</span>: <span class="string">"发布人"</span>, <span class="string">"value"</span>: task_detail[<span class="string">"PubPersonName"</span>]&#125;]&#125;</span><br><span class="line">            <span class="comment"># <span class="doctag">FIXME:</span> 以下是长沙理工大学最新的表单信息，由于某些值（检测时间）必须是动态的，所以只能将form表单写死在这里 （可能会变）</span></span><br><span class="line">            dict_form = &#123;<span class="string">"2fca911d0600717cc5c2f57fc3702787"</span>: [<span class="string">"湖南省"</span>, <span class="string">"长沙市"</span>, <span class="string">"天心区"</span>],</span><br><span class="line">                        <span class="string">"cab886bf693f23a34ed78ed71deaadc3"</span>: yb.name,</span><br><span class="line">                        <span class="string">"b418fa886b6a38bdce72569a70b1fa10"</span>: [<span class="string">"36.2"</span>, <span class="string">"36.3"</span>, <span class="string">"36.4"</span>, <span class="string">"36.5"</span>, <span class="string">"36.6"</span>, <span class="string">"36.7"</span>, <span class="string">"36.8"</span>][random.randint(<span class="number">0</span>, <span class="number">6</span>)], <span class="comment"># 随机体温</span></span><br><span class="line">                        <span class="string">"c77d35b16fb22ec70a1f33c315141dbb"</span>: util.get_time_no_second()&#125;</span><br><span class="line">            submit_result = yb.submit(json.dumps(dict_form, ensure_ascii=<span class="literal">False</span>), json.dumps(</span><br><span class="line">                ex, ensure_ascii=<span class="literal">False</span>), task_detail[<span class="string">"WFId"</span>])</span><br><span class="line">            <span class="keyword">if</span> submit_result[<span class="string">"code"</span>] == <span class="number">0</span>:</span><br><span class="line">                share_url = yb.getShareUrl(submit_result[<span class="string">"data"</span>])[<span class="string">"data"</span>][<span class="string">"uri"</span>]</span><br><span class="line">                print(<span class="string">"已完成一次体温上报[%s]"</span> % task_detail[<span class="string">"Title"</span>])</span><br><span class="line">                print(<span class="string">"访问此网址查看详情：%s"</span> % share_url)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">"[%s]遇到了一些错误:%s"</span> % (task_detail[<span class="string">"Title"</span>], submit_result[<span class="string">"msg"</span>]))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">"出错啦"</span>)</span><br><span class="line">        print(e)</span><br></pre></td></tr></table></figure><h2 id="yiban-py"><a href="#yiban-py" class="headerlink" title="yiban.py"></a>yiban.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> util</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YiBan</span>:</span></span><br><span class="line">    CSRF = <span class="string">"sui-bian-fang-dian-dong-xi"</span>  <span class="comment"># 随机值 随便填点东西</span></span><br><span class="line">    COOKIES = &#123;<span class="string">"csrf_token"</span>: CSRF&#125;  <span class="comment"># 固定cookie 无需更改</span></span><br><span class="line">    HEADERS = &#123;<span class="string">"Origin"</span>: <span class="string">"https://c.uyiban.com"</span>, <span class="string">"User-Agent"</span>: <span class="string">"yiban"</span>&#125;  <span class="comment"># 固定头 无需更改</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, account, passwd)</span>:</span></span><br><span class="line">        self.account = account</span><br><span class="line">        self.passwd = passwd</span><br><span class="line">        self.session = requests.session()</span><br><span class="line">        self.name = <span class="string">""</span></span><br><span class="line">        self.iapp = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(self, url, method=<span class="string">"get"</span>, params=None, cookies=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> method == <span class="string">"get"</span>:</span><br><span class="line">            req = self.session.get(url, params=params, timeout=<span class="number">10</span>, headers=self.HEADERS, cookies=cookies)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            req = self.session.post(url, data=params, timeout=<span class="number">10</span>, headers=self.HEADERS, cookies=cookies)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> req.json()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self)</span>:</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">"mobile"</span>: self.account,</span><br><span class="line">            <span class="string">"imei"</span>: <span class="string">"0"</span>,</span><br><span class="line">            <span class="string">"password"</span>: self.passwd</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># 最新不需要加密密码直接登录的接口来自我B站视频评论用户：破损的鞘翅(bilibili_id:45807603)</span></span><br><span class="line">        r = self.request(url=<span class="string">"https://mobile.yiban.cn/api/v3/passport/login"</span>, params=params)</span><br><span class="line">        <span class="keyword">if</span> r <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> str(r[<span class="string">"response"</span>]) == <span class="string">"100"</span>:</span><br><span class="line">            self.access_token = r[<span class="string">"data"</span>][<span class="string">"user"</span>][<span class="string">"access_token"</span>]</span><br><span class="line">            <span class="keyword">return</span> r</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"账号或密码错误"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getHome</span><span class="params">(self)</span>:</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">"access_token"</span>: self.access_token,</span><br><span class="line">        &#125;</span><br><span class="line">        r = self.request(url=<span class="string">"https://mobile.yiban.cn/api/v3/home"</span>, params=params)</span><br><span class="line">        self.name = r[<span class="string">"data"</span>][<span class="string">"user"</span>][<span class="string">"userName"</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> r[<span class="string">"data"</span>][<span class="string">"hotApps"</span>]: <span class="comment"># 动态取得iapp号 20201117更新</span></span><br><span class="line">            <span class="keyword">if</span> i[<span class="string">"name"</span>] == <span class="string">"易班校本化"</span>:</span><br><span class="line">                self.iapp = re.findall(<span class="string">r"(iapp.*)\?"</span>, i[<span class="string">"url"</span>])[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">auth</span><span class="params">(self)</span>:</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">"act"</span>: self.iapp,</span><br><span class="line">            <span class="string">"v"</span>: self.access_token</span><br><span class="line">        &#125;</span><br><span class="line">        print()</span><br><span class="line">        location = self.session.get(<span class="string">"http://f.yiban.cn/iapp/index"</span>,params=params,</span><br><span class="line">                                    allow_redirects=<span class="literal">False</span>).headers.get(<span class="string">"Location"</span>)</span><br><span class="line">        <span class="keyword">if</span> location <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"该用户可能没进行校方认证，无此APP权限"</span>)</span><br><span class="line">        verifyRequest = re.findall(<span class="string">r"verify_request=(.*?)&amp;"</span>, location)[<span class="number">0</span>]</span><br><span class="line">        result_auth = self.request(</span><br><span class="line">            <span class="string">"https://api.uyiban.com/base/c/auth/yiban?verifyRequest=%s&amp;CSRF=%s"</span> % (verifyRequest, self.CSRF),</span><br><span class="line">            cookies=self.COOKIES)</span><br><span class="line">        data_url = result_auth[<span class="string">"data"</span>].get(<span class="string">"Data"</span>)</span><br><span class="line">        <span class="keyword">if</span> data_url <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  <span class="comment"># 授权过期</span></span><br><span class="line">            result_html = self.session.get(url=data_url, headers=self.HEADERS,</span><br><span class="line">                                           cookies=&#123;<span class="string">"loginToken"</span>: self.access_token&#125;).text</span><br><span class="line">            re_result = re.findall(<span class="string">r'input type="hidden" id="(.*?)" value="(.*?)"'</span>, result_html)</span><br><span class="line">            post_data = &#123;<span class="string">"scope"</span>: <span class="string">"1,2,3,"</span>&#125;</span><br><span class="line">            <span class="keyword">for</span> re_i <span class="keyword">in</span> re_result:</span><br><span class="line">                post_data[re_i[<span class="number">0</span>]] = re_i[<span class="number">1</span>]</span><br><span class="line">            usersure_result = self.session.post(url=<span class="string">"https://oauth.yiban.cn/code/usersure"</span>,</span><br><span class="line">                                                data=post_data,</span><br><span class="line">                                                headers=self.HEADERS, cookies=&#123;<span class="string">"loginToken"</span>: self.access_token&#125;)</span><br><span class="line">            <span class="keyword">if</span> usersure_result.json()[<span class="string">"code"</span>] == <span class="string">"s200"</span>:</span><br><span class="line">                <span class="keyword">return</span> self.auth()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getUncompletedList</span><span class="params">(self)</span>:</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">"CSRF"</span>: self.CSRF,</span><br><span class="line">            <span class="string">"StartTime"</span>: util.get_today(),</span><br><span class="line">            <span class="string">"EndTime"</span>: util.get_time()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">"https://api.uyiban.com/officeTask/client/index/uncompletedList"</span>, params=params,</span><br><span class="line">                            cookies=self.COOKIES)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCompletedList</span><span class="params">(self)</span>:</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">"CSRF"</span>: self.CSRF,</span><br><span class="line">            <span class="string">"StartTime"</span>: util.get_7_day_ago(),</span><br><span class="line">            <span class="string">"EndTime"</span>: util.get_time()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">"https://api.uyiban.com/officeTask/client/index/completedList"</span>, params=params,</span><br><span class="line">                            cookies=self.COOKIES)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getJsonByInitiateId</span><span class="params">(self, initiate_id)</span>:</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">"CSRF"</span>: self.CSRF</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> self.request(<span class="string">"https://api.uyiban.com/workFlow/c/work/show/view/%s"</span> % initiate_id, params=params,</span><br><span class="line">                            cookies=self.COOKIES)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getTaskDetail</span><span class="params">(self, taskId)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.request(</span><br><span class="line">            <span class="string">"https://api.uyiban.com/officeTask/client/index/detail?TaskId=%s&amp;CSRF=%s"</span> % (taskId, self.CSRF),</span><br><span class="line">            cookies=self.COOKIES)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">submit</span><span class="params">(self, data, extend, wfid)</span>:</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">"data"</span>: data,</span><br><span class="line">            <span class="string">"extend"</span>: extend</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> self.request(</span><br><span class="line">            <span class="string">"https://api.uyiban.com/workFlow/c/my/apply/%s?CSRF=%s"</span> % (wfid, self.CSRF), method=<span class="string">"post"</span>,</span><br><span class="line">            params=params,</span><br><span class="line">            cookies=self.COOKIES)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getShareUrl</span><span class="params">(self, initiateId)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.request(</span><br><span class="line">            <span class="string">"https://api.uyiban.com/workFlow/c/work/share?InitiateId=%s&amp;CSRF=%s"</span> % (initiateId, self.CSRF),</span><br><span class="line">            cookies=self.COOKIES)</span><br></pre></td></tr></table></figure><h1 id="😇如何自动？"><a href="#😇如何自动？" class="headerlink" title="😇如何自动？"></a>😇如何自动？</h1><p>买个服务器，使用Linux的crontab就好啦，加上如下规则：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 0 * * * python3 &#x2F;root&#x2F;yiban&#x2F;main.py</span><br></pre></td></tr></table></figure><p>这样就会每天的0点1分运行这个脚本啦。每天看看结果就行了，还想折腾的，可以搞个自动发邮件通知自己即可。</p><p>运行截图(老版本留个纪念)<br><img src="https://cdn.looyeagee.cn/blog/img/2020/02/3012391506.png-blog" alt="图1:打卡运行截图"></p></div><section class="post-copyright"><p class="copyright-item"><span>文章作者:</span> <span>LooyeaGee</span></p><p class="copyright-item"><span>文章链接:</span> <span><a href="https://looyeagee.cn/software/yiban/">https://looyeagee.cn/software/yiban/</a></span></p><p class="copyright-item"><span>版权声明:</span> <span>本博客采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a>进行许可</span></p></section><section class="post-tags"><div><span>标签:</span> <span class="tag"><a href="/tags/%E6%98%93%E7%8F%AD/"># 易班</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"># 自动化</a></span></div><div><a href="javascript:window.history.back();">返回</a> <span>&nbsp;&nbsp; /&nbsp;&nbsp; </span><a href="/archives/">首页</a></div></section><section class="post-nav"><a class="prev" rel="prev" href="/software/class_schedule/">[开源]自动获取当天课表并发送至邮箱</a> <a class="next" rel="next" href="/notes/MP/">Mybatis Plus带多条件的多表联合、分页、排序查询</a></section><br><br><section id="comments" class="comments"><style>.comments{margin:30px;padding:10px;background:#fff}@media screen and (max-width:800px){.comments{margin:auto;padding:10px;background:#fff}}</style><div class="valine_comment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>new Valine({el:".valine_comment",app_id:"GGS59T6lHdF3dH3fhiSJwu4G-MdYXbMMI",app_key:"mqefY3TJMDaBRqc44I7OdYtY",placeholder:"说点什么呗",notify:"false",verify:"false",avatar:"monsterid",visitor:!0})</script></section></article></div></div><footer id="footer" class="footer">访问总量：<span id="pv">加载中...</span><br><a href="http://beian.miit.gov.cn" target="__blank">湘ICP备19026259号-1</a> • <a target="_blank" style="line-height:18px" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43018102000289"><img src="https://cdn.looyeagee.cn/blog/img/wangan.png" data-nobox="true" style="width:16px;height:16px;vertical-align:sub">湘公网安备43018102000289号</a><br>Copyright &copy; 2020 <a href="https://looyeagee.cn/">亦之日记</a> 的博客 • Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></footer><script>const path_name=decodeURI(window.location.pathname);$.ajax({type:"POST",url:"https://api.looyeagee.cn/api/visit"+path_name,success:function(t){$("#article_pv").html(t.hits),$("#pv").html(t.all)},error:function(t){}})</script></div></body></html>